<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Good Dog Spa</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/png" href="../favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/animations.css">
    <link rel="stylesheet" href="../css/utilities.css">
    <style>
        :root { --sidebar-width: 260px; }
        body { min-height: 100vh; background: var(--color-gray-50); }
        .portal-layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: var(--sidebar-width); background: #1e293b; color: var(--color-white); position: fixed; top: 0; left: 0; bottom: 0; overflow-y: auto; z-index: 1000; }
        @media (max-width: 1023px) { .sidebar { transform: translateX(-100%); transition: transform 0.3s; } .sidebar.open { transform: translateX(0); } }
        .sidebar-header { padding: var(--space-6); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-logo { height: 45px; filter: brightness(0) invert(1); }
        .admin-badge { display: inline-block; background: var(--color-coral); color: white; font-size: var(--font-size-xs); padding: 2px 8px; border-radius: var(--radius-full); margin-left: var(--space-2); }
        .sidebar-user { padding: var(--space-5); background: rgba(255,255,255,0.05); margin: var(--space-4); border-radius: var(--radius-xl); }
        .sidebar-user-avatar { width: 50px; height: 50px; background: linear-gradient(135deg, var(--color-coral), #ef4444); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: var(--space-3); }
        .sidebar-user-name { font-weight: var(--font-weight-bold); margin-bottom: var(--space-1); }
        .sidebar-user-email { font-size: var(--font-size-sm); color: rgba(255,255,255,0.6); }
        .sidebar-nav { padding: var(--space-4); }
        .sidebar-nav-label { font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.4); padding: var(--space-3) var(--space-4); margin-top: var(--space-4); }
        .sidebar-nav-label:first-child { margin-top: 0; }
        .sidebar-link { display: flex; align-items: center; gap: var(--space-3); padding: var(--space-3) var(--space-4); color: rgba(255,255,255,0.7); border-radius: var(--radius-lg); margin-bottom: var(--space-1); cursor: pointer; }
        .sidebar-link:hover { background: rgba(255,255,255,0.1); color: var(--color-white); }
        .sidebar-link.active { background: var(--color-coral); color: var(--color-white); }
        .sidebar-footer { padding: var(--space-4); border-top: 1px solid rgba(255,255,255,0.1); position: absolute; bottom: 0; left: 0; right: 0; }
        .logout-btn { display: flex; align-items: center; gap: var(--space-3); width: 100%; padding: var(--space-3) var(--space-4); color: rgba(255,255,255,0.6); border-radius: var(--radius-lg); cursor: pointer; }
        .logout-btn:hover { background: rgba(255,255,255,0.1); color: var(--color-coral); }
        
        /* Main Content */
        .portal-main { flex: 1; margin-left: var(--sidebar-width); min-height: 100vh; }
        @media (max-width: 1023px) { .portal-main { margin-left: 0; } }
        .portal-topbar { background: var(--color-white); padding: var(--space-4) var(--space-6); display: flex; align-items: center; justify-content: space-between; box-shadow: var(--shadow-sm); position: sticky; top: 0; z-index: 100; }
        .mobile-menu-toggle { display: none; width: 44px; height: 44px; align-items: center; justify-content: center; font-size: 1.5rem; background: var(--color-gray-100); border-radius: var(--radius-lg); cursor: pointer; }
        @media (max-width: 1023px) { .mobile-menu-toggle { display: flex; } }
        .page-title h1 { font-size: var(--font-size-xl); margin: 0; }
        .portal-content { padding: var(--space-6); }
        @media (min-width: 768px) { .portal-content { padding: var(--space-8); } }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); opacity: 0; visibility: hidden; z-index: 999; transition: all 0.3s; }
        .sidebar-overlay.open { opacity: 1; visibility: visible; }
        
        /* Tab Panels */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-5); margin-bottom: var(--space-8); }
        .stat-card { background: var(--color-white); border-radius: var(--radius-xl); padding: var(--space-5); box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: var(--space-4); }
        .stat-icon { width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border-radius: var(--radius-xl); }
        .stat-icon.blue { background: var(--color-blue-light); }
        .stat-icon.yellow { background: var(--color-yellow-light); }
        .stat-icon.green { background: #dcfce7; }
        .stat-icon.coral { background: #fee2e2; }
        .stat-info h3 { font-size: var(--font-size-2xl); margin-bottom: 0; }
        .stat-info p { color: var(--color-gray-500); font-size: var(--font-size-sm); margin: 0; }
        
        /* Cards */
        .admin-card { background: var(--color-white); border-radius: var(--radius-xl); box-shadow: var(--shadow-sm); overflow: hidden; margin-bottom: var(--space-6); }
        .admin-card-header { padding: var(--space-5); border-bottom: 1px solid var(--color-gray-100); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--space-3); }
        .admin-card-header h2 { margin: 0; font-size: var(--font-size-lg); }
        .admin-card-body { padding: var(--space-5); }
        
        /* Filters */
        .filters-row { display: flex; flex-wrap: wrap; gap: var(--space-3); align-items: center; }
        .filter-input, .filter-select { padding: var(--space-2) var(--space-4); border: 2px solid var(--color-gray-200); border-radius: var(--radius-lg); font-size: var(--font-size-sm); min-width: 140px; }
        .filter-input:focus, .filter-select:focus { border-color: var(--color-blue-primary); outline: none; }
        
        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: var(--space-3) var(--space-4); text-align: left; border-bottom: 1px solid var(--color-gray-100); }
        .data-table th { background: var(--color-gray-50); font-weight: var(--font-weight-bold); font-size: var(--font-size-sm); color: var(--color-gray-600); white-space: nowrap; }
        .data-table tr:hover { background: var(--color-gray-50); }
        .data-table-wrapper { overflow-x: auto; }
        
        /* Status Badges */
        .status-badge { display: inline-block; padding: var(--space-1) var(--space-3); border-radius: var(--radius-full); font-size: var(--font-size-xs); font-weight: var(--font-weight-bold); }
        .status-badge.confirmed { background: #dcfce7; color: #16a34a; }
        .status-badge.completed { background: var(--color-blue-light); color: var(--color-blue-primary); }
        .status-badge.cancelled { background: #fee2e2; color: #dc2626; }
        .status-badge.pending { background: var(--color-yellow-light); color: #b45309; }
        .status-badge.active { background: #dcfce7; color: #16a34a; }
        
        /* Item Rows */
        .item-row { display: flex; align-items: center; gap: var(--space-3); }
        .item-avatar { width: 40px; height: 40px; border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; font-size: 1rem; flex-shrink: 0; overflow: hidden; }
        .item-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .item-avatar.dog { background: var(--color-yellow-light); }
        .item-avatar.member { background: var(--color-blue-light); }
        .item-info h4 { margin: 0; font-size: var(--font-size-sm); }
        .item-info p { margin: 0; font-size: var(--font-size-xs); color: var(--color-gray-500); }
        
        /* Schedule */
        .schedule-item { display: flex; align-items: center; gap: var(--space-4); padding: var(--space-3) 0; border-bottom: 1px solid var(--color-gray-100); }
        .schedule-item:last-child { border-bottom: none; }
        .schedule-time { font-weight: var(--font-weight-bold); color: var(--color-blue-primary); min-width: 60px; }
        .schedule-info { flex: 1; }
        .schedule-info h4 { margin: 0 0 2px 0; font-size: var(--font-size-sm); }
        .schedule-info p { margin: 0; font-size: var(--font-size-xs); color: var(--color-gray-500); }
        
        /* Empty State */
        .empty-state { text-align: center; padding: var(--space-8); color: var(--color-gray-500); }
        .empty-state-icon { font-size: 3rem; margin-bottom: var(--space-3); }
        
        /* Action Buttons */
        .action-btn { padding: var(--space-1) var(--space-3); border-radius: var(--radius-lg); font-size: var(--font-size-xs); font-weight: var(--font-weight-bold); cursor: pointer; border: none; transition: all 0.2s; }
        .action-btn.confirm { background: #dcfce7; color: #16a34a; }
        .action-btn.confirm:hover { background: #16a34a; color: white; }
        .action-btn.cancel { background: #fee2e2; color: #dc2626; }
        .action-btn.cancel:hover { background: #dc2626; color: white; }
        .action-btn.edit { background: var(--color-blue-light); color: var(--color-blue-primary); }
        .action-btn.edit:hover { background: var(--color-blue-primary); color: white; }
        
        /* Modal */
        .modal { position: fixed; inset: 0; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: var(--space-4); opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal.open { opacity: 1; visibility: visible; }
        .modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.6); }
        .modal-content { position: relative; background: var(--color-white); border-radius: var(--radius-2xl); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .modal-header { padding: var(--space-5) var(--space-6); border-bottom: 1px solid var(--color-gray-100); display: flex; align-items: center; justify-content: space-between; }
        .modal-header h2 { font-size: var(--font-size-xl); margin: 0; }
        .modal-close { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--color-gray-100); border-radius: var(--radius-full); cursor: pointer; font-size: 1.2rem; }
        .modal-close:hover { background: var(--color-coral); color: white; }
        .modal-body { padding: var(--space-6); }
        .modal-footer { padding: var(--space-4) var(--space-6); background: var(--color-gray-50); display: flex; gap: var(--space-3); justify-content: flex-end; }
        
        /* Form */
        .form-group { margin-bottom: var(--space-4); }
        .form-group label { display: block; font-weight: var(--font-weight-bold); margin-bottom: var(--space-2); font-size: var(--font-size-sm); }
        .form-group input, .form-group select { width: 100%; padding: var(--space-3); border: 2px solid var(--color-gray-200); border-radius: var(--radius-lg); font-size: var(--font-size-base); }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--color-blue-primary); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); }
        
        /* Credits Display */
        .credits-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: var(--space-3); margin-bottom: var(--space-4); }
        .credit-item { background: var(--color-gray-50); padding: var(--space-3); border-radius: var(--radius-lg); text-align: center; }
        .credit-item .count { font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); color: var(--color-blue-primary); }
        .credit-item .label { font-size: var(--font-size-xs); color: var(--color-gray-500); }
        .credit-adjust { display: flex; align-items: center; gap: var(--space-2); }
        .credit-adjust button { width: 32px; height: 32px; border-radius: var(--radius-full); border: none; font-size: 1.2rem; cursor: pointer; }
        .credit-adjust .minus { background: #fee2e2; color: #dc2626; }
        .credit-adjust .plus { background: #dcfce7; color: #16a34a; }
        .credit-adjust input { width: 60px; text-align: center; padding: var(--space-2); border: 2px solid var(--color-gray-200); border-radius: var(--radius-lg); }
        
        /* Grid */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-6); }
        @media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="portal-layout">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="../index.html"><img src="https://wigramvet.co.nz/wp-content/uploads/2019/01/gooddogspa-2.png" alt="Good Dog Spa" class="sidebar-logo"></a>
                <span class="admin-badge">ADMIN</span>
            </div>
            <div class="sidebar-user" id="sidebarUser">
                <div class="sidebar-user-avatar">üë§</div>
                <div class="sidebar-user-name">Spa Admin</div>
                <div class="sidebar-user-email">admin@gooddogspa.co.nz</div>
            </div>
            <nav class="sidebar-nav">
                <div class="sidebar-nav-label">Admin Menu</div>
                <a class="sidebar-link active" data-tab="overview"><span class="sidebar-link-icon">üìä</span>Overview</a>
                <a class="sidebar-link" data-tab="bookings"><span class="sidebar-link-icon">üìÖ</span>All Bookings</a>
                <a class="sidebar-link" data-tab="dogs"><span class="sidebar-link-icon">üêï</span>All Dogs</a>
                
                <div class="sidebar-nav-label">Quick Links</div>
                <a href="../index.html" class="sidebar-link"><span class="sidebar-link-icon">üåê</span>Main Website</a>
            </nav>
            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()"><span>üö™</span> Sign Out</button>
            </div>
        </aside>
        
        <main class="portal-main">
            <div class="portal-topbar">
                <button class="mobile-menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <div class="page-title"><h1 id="pageTitle">Admin Overview</h1></div>
                <div class="topbar-date" id="currentDate"></div>
            </div>
            
            <div class="portal-content">
                <!-- Overview Tab -->
                <div class="tab-panel active" id="tab-overview">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon blue">üìÖ</div>
                            <div class="stat-info">
                                <h3 id="statTodayBookings">0</h3>
                                <p>Today's Bookings</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon yellow">üêï</div>
                            <div class="stat-info">
                                <h3 id="statTotalDogs">0</h3>
                                <p>Registered Dogs</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon green">üë•</div>
                            <div class="stat-info">
                                <h3 id="statTotalMembers">0</h3>
                                <p>Active Members</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon coral">üìÜ</div>
                            <div class="stat-info">
                                <h3 id="statWeekBookings">0</h3>
                                <p>This Week</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h2>üìÖ Today's Schedule</h2>
                                <span id="todayDate"></span>
                            </div>
                            <div class="admin-card-body" id="todaySchedule">
                                <div class="empty-state">
                                    <div class="empty-state-icon">üì≠</div>
                                    <p>No bookings today</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h2>üìã Upcoming Bookings</h2>
                            </div>
                            <div class="admin-card-body" id="upcomingBookings"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Bookings Tab -->
                <div class="tab-panel" id="tab-bookings">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h2>üìÖ All Bookings</h2>
                            <div class="filters-row">
                                <input type="date" class="filter-input" id="filterDateFrom" title="From date">
                                <input type="date" class="filter-input" id="filterDateTo" title="To date">
                                <select class="filter-select" id="filterStatus">
                                    <option value="">All Status</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <select class="filter-select" id="filterType">
                                    <option value="">All Types</option>
                                    <option value="daycare">Daycare</option>
                                    <option value="hydrotherapy">Hydrotherapy</option>
                                </select>
                                <button class="btn btn-primary btn-sm" onclick="openAddBookingModal()">+ Add Booking</button>
                            </div>
                        </div>
                        <div class="data-table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Dog</th>
                                        <th>Owner</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="allBookingsBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Dogs Tab -->
                <div class="tab-panel" id="tab-dogs">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h2>üêï Registered Dogs</h2>
                            <div class="filters-row">
                                <input type="text" class="filter-input" id="filterDogSearch" placeholder="Search dogs or owners...">
                            </div>
                        </div>
                        <div class="data-table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Dog</th>
                                        <th>Breed</th>
                                        <th>Age</th>
                                        <th>Owner</th>
                                        <th>Owner Credits</th>
                                        <th>Assessment</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="allDogsBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Edit Credits Modal -->
    <div class="modal" id="creditsModal">
        <div class="modal-backdrop" onclick="closeCreditsModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí≥ Manage Credits</h2>
                <button class="modal-close" onclick="closeCreditsModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="memberInfo" style="margin-bottom: var(--space-5); padding-bottom: var(--space-4); border-bottom: 2px dashed var(--color-gray-200);"></div>
                
                <h4 style="margin-bottom: var(--space-4);">Credit Balances</h4>
                <div class="form-group">
                    <label>Full Day Credits</label>
                    <div class="credit-adjust">
                        <button class="minus" onclick="adjustCredit('fullDay', -1)">‚àí</button>
                        <input type="number" id="creditFullDay" value="0" min="0">
                        <button class="plus" onclick="adjustCredit('fullDay', 1)">+</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Half Day Credits</label>
                    <div class="credit-adjust">
                        <button class="minus" onclick="adjustCredit('halfDay', -1)">‚àí</button>
                        <input type="number" id="creditHalfDay" value="0" min="0">
                        <button class="plus" onclick="adjustCredit('halfDay', 1)">+</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>3 Hour Credits</label>
                    <div class="credit-adjust">
                        <button class="minus" onclick="adjustCredit('threeHour', -1)">‚àí</button>
                        <input type="number" id="creditThreeHour" value="0" min="0">
                        <button class="plus" onclick="adjustCredit('threeHour', 1)">+</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Rehab 30min Credits</label>
                    <div class="credit-adjust">
                        <button class="minus" onclick="adjustCredit('rehab30', -1)">‚àí</button>
                        <input type="number" id="creditRehab30" value="0" min="0">
                        <button class="plus" onclick="adjustCredit('rehab30', 1)">+</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Rehab 60min Credits</label>
                    <div class="credit-adjust">
                        <button class="minus" onclick="adjustCredit('rehab60', -1)">‚àí</button>
                        <input type="number" id="creditRehab60" value="0" min="0">
                        <button class="plus" onclick="adjustCredit('rehab60', 1)">+</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeCreditsModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveCredits()">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Add Booking Modal -->
    <div class="modal" id="bookingModal">
        <div class="modal-backdrop" onclick="closeBookingModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Add Booking</h2>
                <button class="modal-close" onclick="closeBookingModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Dog</label>
                    <select id="bookingDogSelect">
                        <option value="">Choose a dog...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Service Type</label>
                    <select id="bookingTypeSelect" onchange="updateSessionOptions()">
                        <option value="daycare">Daycare</option>
                        <option value="hydrotherapy">Hydrotherapy</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Session</label>
                    <select id="bookingSessionSelect"></select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="bookingDateInput">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="bookingTimeInput" value="08:00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes (optional)</label>
                    <input type="text" id="bookingNotesInput" placeholder="Any special notes...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeBookingModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createBooking()">Create Booking</button>
            </div>
        </div>
    </div>
    
    <script src="../js/services/mockAuth.js"></script>
    <script src="../js/services/mockDatabase.js"></script>
    <script>
        // Tab Navigation
        const tabLinks = document.querySelectorAll('.sidebar-link[data-tab]');
        const tabPanels = document.querySelectorAll('.tab-panel');
        const pageTitle = document.getElementById('pageTitle');
        
        const tabTitles = {
            'overview': 'Admin Overview',
            'bookings': 'All Bookings',
            'dogs': 'All Dogs'
        };
        
        tabLinks.forEach(link => {
            link.addEventListener('click', () => {
                const tabId = link.dataset.tab;
                tabLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                tabPanels.forEach(panel => {
                    panel.classList.remove('active');
                    if (panel.id === 'tab-' + tabId) panel.classList.add('active');
                });
                pageTitle.textContent = tabTitles[tabId] || 'Admin Dashboard';
                document.getElementById('sidebar').classList.remove('open');
                document.getElementById('sidebarOverlay').classList.remove('open');
            });
        });
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('open');
        }
        
        function logout() {
            MockAuth.signOut();
            window.location.href = '../login.html';
        }
        
        // Auth check
        const user = MockAuth.getCurrentUser();
        if (!user || user.role !== 'admin') {
            window.location.href = 'dashboard.html';
        }
        
        // Update sidebar user
        document.getElementById('sidebarUser').innerHTML = `
            <div class="sidebar-user-avatar">üë§</div>
            <div class="sidebar-user-name">${user.displayName}</div>
            <div class="sidebar-user-email">${user.email}</div>
        `;
        
        // Set current date
        const today = new Date();
        document.getElementById('currentDate').textContent = today.toLocaleDateString('en-NZ', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('todayDate').textContent = today.toLocaleDateString('en-NZ', { weekday: 'short', month: 'short', day: 'numeric' });
        
        // Data helpers
        function getCollection(name) {
            const key = 'gooddogspa_db_' + name;
            return JSON.parse(localStorage.getItem(key) || '[]');
        }
        
        function saveCollection(name, data) {
            localStorage.setItem('gooddogspa_db_' + name, JSON.stringify(data));
        }
        
        function getCreditsForUser(userId) {
            const credits = JSON.parse(localStorage.getItem('gooddogspa_db_credits') || '{}');
            return credits[userId] || { fullDay: 0, halfDay: 0, threeHour: 0, rehab30: 0, rehab60: 0 };
        }
        
        function saveCreditsForUser(userId, credits) {
            const allCredits = JSON.parse(localStorage.getItem('gooddogspa_db_credits') || '{}');
            allCredits[userId] = credits;
            localStorage.setItem('gooddogspa_db_credits', JSON.stringify(allCredits));
        }
        
        const allUsers = JSON.parse(localStorage.getItem('gooddogspa_users') || '[]').filter(u => u.role === 'member');
        const allDogs = getCollection('dogs');
        const allBookings = getCollection('bookings');
        
        function getUserById(uid) {
            const users = JSON.parse(localStorage.getItem('gooddogspa_users') || '[]');
            return users.find(u => u.uid === uid) || { displayName: 'Unknown', email: '-' };
        }
        
        function getDogById(id) {
            return allDogs.find(d => d.id === id) || { name: 'Unknown' };
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-NZ', { weekday: 'short', day: 'numeric', month: 'short' });
        }
        
        // Calculate stats
        const todayStr = today.toISOString().split('T')[0];
        const todayBookings = allBookings.filter(b => b.date === todayStr && b.status !== 'cancelled');
        
        const weekFromNow = new Date(today);
        weekFromNow.setDate(weekFromNow.getDate() + 7);
        const weekBookings = allBookings.filter(b => {
            const bookingDate = new Date(b.date);
            return bookingDate >= today && bookingDate <= weekFromNow && b.status !== 'cancelled';
        });
        
        document.getElementById('statTodayBookings').textContent = todayBookings.length;
        document.getElementById('statTotalDogs').textContent = allDogs.length;
        document.getElementById('statTotalMembers').textContent = allUsers.length;
        document.getElementById('statWeekBookings').textContent = weekBookings.length;
        
        // Today's Schedule
        const scheduleContainer = document.getElementById('todaySchedule');
        if (todayBookings.length > 0) {
            scheduleContainer.innerHTML = todayBookings.map(booking => {
                const owner = getUserById(booking.ownerId);
                const time = booking.dropOff || booking.time || '09:00';
                const typeLabel = booking.type === 'daycare' ? 'Daycare' : 'Hydro';
                return `
                    <div class="schedule-item">
                        <div class="schedule-time">${time}</div>
                        <div class="schedule-info">
                            <h4>${booking.dogName} - ${typeLabel}</h4>
                            <p>${owner.displayName}</p>
                        </div>
                        <span class="status-badge ${booking.status}">${booking.status}</span>
                    </div>
                `;
            }).join('');
        }
        
        // Upcoming Bookings
        const upcoming = allBookings
            .filter(b => b.date >= todayStr && b.status === 'confirmed')
            .sort((a, b) => new Date(a.date) - new Date(b.date))
            .slice(0, 8);
        
        document.getElementById('upcomingBookings').innerHTML = upcoming.length > 0 
            ? upcoming.map(b => {
                const owner = getUserById(b.ownerId);
                return `
                    <div class="schedule-item">
                        <div class="schedule-time">${formatDate(b.date)}</div>
                        <div class="schedule-info">
                            <h4>${b.dogName}</h4>
                            <p>${owner.displayName} ‚Ä¢ ${b.type}</p>
                        </div>
                    </div>
                `;
            }).join('')
            : '<div class="empty-state"><p>No upcoming bookings</p></div>';
        
        // All Bookings Table
        function renderAllBookings(bookings) {
            const body = document.getElementById('allBookingsBody');
            body.innerHTML = bookings.map(b => {
                const owner = getUserById(b.ownerId);
                const time = b.dropOff ? `${b.dropOff} - ${b.pickUp}` : b.time || '-';
                return `
                    <tr>
                        <td>${formatDate(b.date)}</td>
                        <td>${time}</td>
                        <td><strong>${b.dogName}</strong></td>
                        <td>${owner.displayName}</td>
                        <td>${b.type === 'daycare' ? 'Daycare' : 'Hydro'}</td>
                        <td><span class="status-badge ${b.status}">${b.status}</span></td>
                        <td>
                            ${b.status === 'confirmed' ? `
                                <button class="action-btn confirm" onclick="completeBooking('${b.id}')">‚úì Complete</button>
                                <button class="action-btn cancel" onclick="cancelBooking('${b.id}')">‚úï Cancel</button>
                            ` : '-'}
                        </td>
                    </tr>
                `;
            }).join('') || '<tr><td colspan="7" class="empty-state">No bookings found</td></tr>';
        }
        
        renderAllBookings(allBookings.sort((a, b) => new Date(b.date) - new Date(a.date)));
        
        // Booking filters
        document.getElementById('filterDateFrom').addEventListener('change', applyBookingFilters);
        document.getElementById('filterDateTo').addEventListener('change', applyBookingFilters);
        document.getElementById('filterStatus').addEventListener('change', applyBookingFilters);
        document.getElementById('filterType').addEventListener('change', applyBookingFilters);
        
        function applyBookingFilters() {
            let filtered = [...allBookings];
            const fromDate = document.getElementById('filterDateFrom').value;
            const toDate = document.getElementById('filterDateTo').value;
            const status = document.getElementById('filterStatus').value;
            const type = document.getElementById('filterType').value;
            
            if (fromDate) filtered = filtered.filter(b => b.date >= fromDate);
            if (toDate) filtered = filtered.filter(b => b.date <= toDate);
            if (status) filtered = filtered.filter(b => b.status === status);
            if (type) filtered = filtered.filter(b => b.type === type);
            
            renderAllBookings(filtered.sort((a, b) => new Date(b.date) - new Date(a.date)));
        }
        
        function completeBooking(id) {
            if (confirm('Mark this booking as completed?')) {
                const bookings = getCollection('bookings');
                const idx = bookings.findIndex(b => b.id === id);
                if (idx > -1) {
                    bookings[idx].status = 'completed';
                    saveCollection('bookings', bookings);
                    location.reload();
                }
            }
        }
        
        function cancelBooking(id) {
            if (confirm('Cancel this booking? Credits will be refunded if applicable.')) {
                const bookings = getCollection('bookings');
                const idx = bookings.findIndex(b => b.id === id);
                if (idx > -1) {
                    const booking = bookings[idx];
                    // Refund credits if paid with credits
                    if (booking.paidWithCredits && booking.creditType) {
                        const credits = getCreditsForUser(booking.ownerId);
                        credits[booking.creditType] = (credits[booking.creditType] || 0) + 1;
                        saveCreditsForUser(booking.ownerId, credits);
                    }
                    bookings[idx].status = 'cancelled';
                    saveCollection('bookings', bookings);
                    location.reload();
                }
            }
        }
        
        // All Dogs Table
        function renderAllDogs(dogs) {
            const body = document.getElementById('allDogsBody');
            body.innerHTML = dogs.map(d => {
                const owner = getUserById(d.ownerId);
                const credits = getCreditsForUser(d.ownerId);
                const totalCredits = Object.values(credits).reduce((a, b) => a + b, 0);
                return `
                    <tr>
                        <td>
                            <div class="item-row">
                                <div class="item-avatar dog">
                                    ${d.photo ? `<img src="${d.photo}" alt="${d.name}">` : 'üêï'}
                                </div>
                                <div class="item-info">
                                    <h4>${d.name}</h4>
                                    <p>${d.gender}, ${d.weight}kg</p>
                                </div>
                            </div>
                        </td>
                        <td>${d.breed}</td>
                        <td>${d.age} yrs</td>
                        <td>
                            <div class="item-info">
                                <h4>${owner.displayName}</h4>
                                <p>${owner.phone || '-'}</p>
                            </div>
                        </td>
                        <td><strong>${totalCredits}</strong> total</td>
                        <td><span class="status-badge ${d.assessmentPassed ? 'confirmed' : 'pending'}">${d.assessmentPassed ? 'Passed ‚úì' : 'Pending'}</span></td>
                        <td>
                            <button class="action-btn edit" onclick="openCreditsModal('${d.ownerId}')">üí≥ Credits</button>
                        </td>
                    </tr>
                `;
            }).join('') || '<tr><td colspan="7" class="empty-state">No dogs found</td></tr>';
        }
        
        renderAllDogs(allDogs);
        
        // Dogs filter
        document.getElementById('filterDogSearch').addEventListener('input', (e) => {
            const search = e.target.value.toLowerCase();
            const filtered = allDogs.filter(d => {
                const owner = getUserById(d.ownerId);
                return d.name.toLowerCase().includes(search) ||
                       d.breed.toLowerCase().includes(search) ||
                       owner.displayName.toLowerCase().includes(search);
            });
            renderAllDogs(filtered);
        });
        
        // Credits Modal
        let currentEditUserId = null;
        
        function openCreditsModal(userId) {
            currentEditUserId = userId;
            const user = getUserById(userId);
            const credits = getCreditsForUser(userId);
            
            document.getElementById('memberInfo').innerHTML = `
                <div class="item-row">
                    <div class="item-avatar member">üë§</div>
                    <div class="item-info">
                        <h4>${user.displayName}</h4>
                        <p>${user.email} ‚Ä¢ ${user.phone || 'No phone'}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('creditFullDay').value = credits.fullDay || 0;
            document.getElementById('creditHalfDay').value = credits.halfDay || 0;
            document.getElementById('creditThreeHour').value = credits.threeHour || 0;
            document.getElementById('creditRehab30').value = credits.rehab30 || 0;
            document.getElementById('creditRehab60').value = credits.rehab60 || 0;
            
            document.getElementById('creditsModal').classList.add('open');
        }
        
        function closeCreditsModal() {
            document.getElementById('creditsModal').classList.remove('open');
            currentEditUserId = null;
        }
        
        function adjustCredit(type, delta) {
            const input = document.getElementById('credit' + type.charAt(0).toUpperCase() + type.slice(1));
            let val = parseInt(input.value) || 0;
            val = Math.max(0, val + delta);
            input.value = val;
        }
        
        function saveCredits() {
            if (!currentEditUserId) return;
            
            const credits = {
                fullDay: parseInt(document.getElementById('creditFullDay').value) || 0,
                halfDay: parseInt(document.getElementById('creditHalfDay').value) || 0,
                threeHour: parseInt(document.getElementById('creditThreeHour').value) || 0,
                rehab30: parseInt(document.getElementById('creditRehab30').value) || 0,
                rehab60: parseInt(document.getElementById('creditRehab60').value) || 0
            };
            
            saveCreditsForUser(currentEditUserId, credits);
            closeCreditsModal();
            alert('Credits updated successfully!');
            renderAllDogs(allDogs);
        }
        
        // Add Booking Modal
        function openAddBookingModal() {
            // Populate dogs dropdown
            const select = document.getElementById('bookingDogSelect');
            select.innerHTML = '<option value="">Choose a dog...</option>' +
                allDogs.map(d => {
                    const owner = getUserById(d.ownerId);
                    return `<option value="${d.id}" data-owner="${d.ownerId}">${d.name} (${owner.displayName})</option>`;
                }).join('');
            
            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('bookingDateInput').value = tomorrow.toISOString().split('T')[0];
            
            updateSessionOptions();
            document.getElementById('bookingModal').classList.add('open');
        }
        
        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('open');
        }
        
        function updateSessionOptions() {
            const type = document.getElementById('bookingTypeSelect').value;
            const select = document.getElementById('bookingSessionSelect');
            
            if (type === 'daycare') {
                select.innerHTML = `
                    <option value="full">Full Day (7am-6pm)</option>
                    <option value="half-am">Half Day AM (7am-12:30pm)</option>
                    <option value="half-pm">Half Day PM (12:30pm-6pm)</option>
                    <option value="3hour">3 Hour Stay</option>
                `;
            } else {
                select.innerHTML = `
                    <option value="30min">30 Minute Session</option>
                    <option value="60min">60 Minute Session</option>
                `;
            }
        }
        
        function createBooking() {
            const dogId = document.getElementById('bookingDogSelect').value;
            const type = document.getElementById('bookingTypeSelect').value;
            const session = document.getElementById('bookingSessionSelect').value;
            const date = document.getElementById('bookingDateInput').value;
            const time = document.getElementById('bookingTimeInput').value;
            const notes = document.getElementById('bookingNotesInput').value;
            
            if (!dogId || !date) {
                alert('Please select a dog and date');
                return;
            }
            
            const dog = getDogById(dogId);
            const option = document.getElementById('bookingDogSelect').selectedOptions[0];
            const ownerId = option.dataset.owner;
            
            const bookingData = {
                id: 'booking-' + Date.now(),
                ownerId: ownerId,
                dogId: dogId,
                dogName: dog.name,
                type: type,
                sessionType: session,
                date: date,
                status: 'confirmed',
                notes: notes,
                paidWithCredits: false,
                createdAt: new Date().toISOString()
            };
            
            if (type === 'daycare') {
                bookingData.dropOff = time || '08:00';
                bookingData.pickUp = session === 'half-am' ? '12:30' : session === 'half-pm' ? '18:00' : '17:00';
            } else {
                bookingData.time = time || '10:00';
            }
            
            const bookings = getCollection('bookings');
            bookings.push(bookingData);
            saveCollection('bookings', bookings);
            
            closeBookingModal();
            alert('Booking created successfully!');
            location.reload();
        }
    </script>
</body>
</html>
